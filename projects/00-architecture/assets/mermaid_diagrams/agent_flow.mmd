sequenceDiagram
    participant U as 👤 User
    participant W as 🖥️ WebUI
    participant A as 🔄 ALB/API Gateway
    participant B as 🤖 Agent Brown
    participant S as 📦 S3 Bridge
    participant E as ⚡ EventBridge
    participant BY as 🧠 Agent Bayko
    participant M as 🔀 MCP Router
    participant T as 🛠️ AI Toolchain
    participant O as 📁 Output S3
    participant C as ☁️ CloudFront

    Note over U,C: Multi-Agent Processing Pipeline Flow

    U->>W: 1. Submit processing request<br/>"Analyze quarterly data"
    W->>A: 2. HTTP POST /process
    A->>B: 3. Route to Agent Brown

    Note over B: Input Processing & Validation
    B->>B: 4a. Sanitize & validate input
    B->>B: 4b. Apply processing profile
    B->>B: 4c. Generate UUID & metadata

    B->>S: 5. Write task_config.json<br/>{"request": "...", "profile": "enterprise", "uuid": "..."}

    Note over S,E: Cross-VPC Communication
    S->>E: 6. S3 Event Notification
    E->>BY: 7. Trigger Agent Bayko

    Note over BY,T: MCP Orchestration & Processing
    BY->>S: 8. Read task_config.json
    BY->>M: 9. Initialize MCP Router

    M->>T: 10a. Process with LLM
    T-->>M: 10b. Structured analysis

    M->>T: 11a. Transform data
    T-->>M: 11b. Processed dataset

    M->>T: 12a. Validate output
    T-->>M: 12b. Quality metrics

    M->>T: 13a. Assemble results
    T-->>M: 13b. Final package

    BY->>BY: 14. Package output<br/>(structured payload)

    Note over O,C: Output Delivery
    BY->>O: 15. Write to output/{uuid}/payload.json
    O->>C: 16. Distribute via CDN

    Note over W: Status Monitoring
    BY->>S: 17. Write completion status
    B->>S: 18. Monitor for completion
    B->>W: 19. Return signed URL
    W->>U: 20. Display results

    Note over U,C: Session Complete